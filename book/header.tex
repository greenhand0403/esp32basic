% header.tex
\usepackage{graphicx}

% 设定一个图片最大宽度阈值（单位 LaTeX 长度）
% 例如：300pt ≈ 400px 左右（粗略换算，1px≈0.75pt）
\newdimen\ImgCap
\ImgCap=300pt

\makeatletter
% 计算：若原始宽度 > 阈值，则取阈值；否则用原始宽度
\def\maximgwidth{%
  \ifdim\Gin@nat@width>\ImgCap \ImgCap \else \Gin@nat@width\fi}
\makeatother

% 全局默认：按 \maximgwidth 缩放，保持纵横比
\setkeys{Gin}{width=\maximgwidth, keepaspectratio}